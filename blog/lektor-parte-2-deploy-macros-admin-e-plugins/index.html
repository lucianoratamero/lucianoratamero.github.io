<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{},{}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.ba4c128a.js"}catch(e){main="/client/legacy/client.b5ae4b81.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <link href=client/client-2e2ca2b4.css rel=stylesheet> <title> Lektor parte 2: deploy, macros, admin e plugins - luciano@ratamero.com </title><style>.hljs{display:block;overflow-x:auto;padding:.5em;background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{color:#569cd6;text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212;display:inline-block;width:100%}.hljs-deletion{background-color:#600;display:inline-block;width:100%}</style><link href=https://fonts.gstatic.com rel=preconnect data-svelte=svelte-1vo6mso><link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel=stylesheet data-svelte=svelte-1vo6mso><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap" rel=stylesheet data-svelte=svelte-1vo6mso><meta content="agora que já expliquei o básico de como utilizar o Lektor pra desenvolver seu site estático, vou começar a explicar alguns aspectos mais avançados. :]" name=description data-svelte=svelte-1qqwwq><meta content="Luciano Ratamero, lektor, python, site estático, deploy, macros, admin, plugins" name=keywords data-svelte=svelte-1qqwwq> <link href=/client/client.ba4c128a.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-2e2ca2b4.css rel=preload as=style><link href=/client/index.bb8956cb.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/utils.534d48ce.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js.gz rel=modulepreload as=script crossorigin=use-credentials></head> <body> <div id=sapper> <section class="dark-theme theme"><section class=transition-wrapper><main><article class=blog-post> <h1><mark>Lektor parte 2: deploy, macros, admin e plugins</mark></h1> <p class=meta>2016-02-03</p> <figure><a href=https://getlektor.com/ target=_blank><img alt="Lektor's logo" src=https://lucianoratamero.github.io/img/cover-lektor-2.png></a></figure> <p>agora que já expliquei o básico de como utilizar o Lektor pra desenvolver seu site estático, vou começar a explicar alguns aspectos mais avançados. não pretendo ser muito detalhista, mas fiquem a vontade para pedir mais informações nos comentários. aí vai! </p> <hr> <h3>deploy</h3> <p>sim, o Lektor vem pronto para uma série de opções para deploy facilitado: <a href=https://www.getlektor.com/docs/deployment/rsync/ >rsync</a>, <a href=https://www.getlektor.com/docs/deployment/ftp/ >ftp</a>, <a href=https://www.getlektor.com/docs/deployment/ghpages/ >github pages</a> e, via plugin, <a href=https://github.com/spenczar/lektor-s3>s3</a>. isso significa que basta ter um local remoto para manter seus arquivos estáticos que você tem um site pronto, com deploy e tudo. </p> <p>o deploy dele é facilmente configurado e bem inteligente, já que ele verifica somente os arquivos que precisam ser alterados e os sobrescreve. para configurar, basta seguir <a href=https://www.getlektor.com/docs/deployment/#lektor-assisted-deployments>a documentação</a> do método escolhido e rodar <code>lektor build lektor deploy</code>. esse processo garante que o Lektor pegará a versão mais nova antes de sincronizar com o servidor. </p> <p>no meu caso, foi só (juro que foi só isso) colocar o seguinte no meu arquivo de projeto, o <code>blog.lektorproject</code>: </p> <pre class=hljs><code><span class=hljs-string>[servers.ghpages]</span></code><br><code><span class=hljs-string>target</span> <span class=hljs-string>=</span> <span class=hljs-string>ghpages+https://lucianoratamero/blog</span></code></pre> <p>não cheguei a ver os outros, mas <strong>duvido</strong> que sejam muito mais complicados que isso. </p> <h3>macros</h3> <p>quando você tiver brincado o suficiente com os modelos do Lektor, você vai sentir falta de iteradores de template. um exemplo clássico é uma página de resumo dos posts de um blog, como a que eu tenho na home desse aqui. </p> <p>pra isso, existem as macros. elas são templates com lógicas embutidas. mais fácil de explicar mostrando um exemplo. </p> <pre class=hljs><code><span class=hljs-template-tag>{% <span class=hljs-name>macro</span> render_blog_post(post, from_index=false) %}</span></code><br><code>  &lt;div class="blog-post"></code><br><code>  <span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>if</span></span> from_index %}</span></code><br><code>    &lt;h2>&lt;a href="<span class=hljs-template-variable>{{ post|url }}</span>"><span class=hljs-template-variable>{{ post.title }}</span>&lt;/a>&lt;/h2></code><br><code>  <span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>else</span></span> %}</span></code><br><code>    &lt;h2><span class=hljs-template-variable>{{ post.title }}</span>&lt;/h2></code><br><code>  <span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endif</span></span> %}</span></code><br><code>  &lt;p class="meta"></code><br><code>    <span class=hljs-template-variable>{{ post.pub_date }}</span></code><br><code>  &lt;/p></code><br><code>  <span class=hljs-template-variable>{{ post.body }}</span></code><br><code>  &lt;/div></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name>endmacro</span> %}</span></code></pre> <p>o papel dessa macro é receber um objeto <code>post</code> e formatá-lo de acordo com o template. ele é usado pelo template de blog da seguinte forma: </p> <pre class=hljs><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>extends</span></span> "layout.html" %}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name>from</span> "macros/blog.html" import render_blog_post %}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name>from</span> "macros/pagination.html" import render_pagination %}</span></code><br><code></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>block</span></span> title %}</span></code><br><code>  <span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>if</span></span> this.title %}</span><span class=hljs-template-variable>{{ this.title }}</span><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>else</span></span> %}</span>olar<span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endif</span></span> %}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endblock</span></span> %}</span></code><br><code></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>block</span></span> body %}</span></code><br><code>  <span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>for</span></span> child <span class=hljs-keyword>in</span> this.pagination.items %}</span></code><br><code>    <span class=hljs-template-variable>{{ render_blog_post(child, from_index=true) }}</span></code><br><code>  <span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endfor</span></span> %}</span></code><br><code></code><br><code>  <span class=hljs-template-variable>{{ render_pagination(this.pagination) }}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endblock</span></span> %}</span></code></pre> <p>vemos assim que só é necessário importar a macro criada e passar os objetos corretos. pra saber quais objetos e como usá-los, é só dar uma olhada na documentação da <a href=https://www.getlektor.com/docs/api/db/ >API de tratamento de dados</a> do Lektor. </p> <h3>admin</h3> <p>ah, sim, o Lektor, quando usado localmente, oferece uma interface administrativa pra edição e criação de conteúdo. pra usá-la, basta rodar o servidor com <code>lektor server</code>, acessar a página <code>localhost:5000</code> e clicar no ícone do lápis do canto da tela. </p> <figure><img alt="Mostrando o link do admin no topo direito da tela" src=https://lucianoratamero.github.io/img/acessando-o-admin.jpg></figure> <p>isso te levará pra uma página do admin similar à essa:</p> <figure><img alt="Exemplo de página de admin" src=https://lucianoratamero.github.io/img/admin.jpg></figure> <p>todas as alterações feitas nela refletirão nos seus arquivos do projeto e vice-versa. fica na sua preferência utilizar a interface administrativa ou editar os arquivos <code>content.lr</code> diretamente. :) mais um pouco e já poderemos colocar isso na mão dos próprios clientes! </p> <h3>plugins</h3> <p>como o Lektor é bem documentado e extensível, ficou fácil pra (pequena) comunidade criar plugins que adicionam novos comportamentos. vocês devem ter notado que uso o disqus como plataforma de comentários, e não tive trabalho quase nenhum pra colocá-lo no blog, quase nenhum <strong>mesmo</strong>. </p> <p>pra usar um plugin, é só procurar na <a href=https://www.getlektor.com/docs/plugins/ >página de plugins do Lektor</a> o plugin que quer usar e seguir a própria documentação. vou demonstrar pra vocês como foi fácil colocar o <a href=https://github.com/lektor/lektor-disqus-comments>plugin de comentários do disqus</a>. </p> <p>o que eu fiz foi abrir o aquivo <code>blog.lektorproject</code> na raiz do meu projeto (o nome do arquivo varia com o nome do projeto) e colocar as seguintes linhas: </p> <pre class=hljs><code><span class=hljs-string>[packages]</span></code><br><code><span class=hljs-string>lektor-disqus-comments</span> <span class=hljs-string>=</span> <span class=hljs-number>0.1</span></code></pre> <p>isso fez com que, quando eu rodasse <code>lektor server</code> ou <code>lektor build</code>, ele detectasse minha intenção, instalasse as dependências e ficasse pronto pra usar o plugin. </p> <p>depois disso, fui no <a href="https://publishers.disqus.com/engage?utm_source=Home-Nav">disqus</a> e criei uma comunidade pro blog (é bem autoexplicativo o processo, não me demorou dois minutos). </p> <p>com o nome da comunidade em mãos, criei uma pasta <code>configs/</code> na raiz do projeto com um arquivo <code>disqus-comments.ini</code> dentro. nesse arquivo, só precisei declarar o shortname da comunidade. </p> <pre><code>shortname = lucianoratamerosblog</code></pre> <p>com o disqus configurado, escolhi o template de blog-post pra habilitar os comentários e os coloquei assim: </p> <pre class=hljs><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>extends</span></span> "layout.html" %}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name>from</span> "macros/blog.html" import render_blog_post %}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>block</span></span> title %}</span><span class=hljs-template-variable>{{ this.title }}</span><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endblock</span></span> %}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>block</span></span> tags %}</span><span class=hljs-template-variable>{{ this.tags }}</span><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endblock</span></span> %}</span></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>block</span></span> body %}</span></code><br><code>  <span class=hljs-template-variable>{{ render_blog_post(this) }}</span></code><br><code>  &lt;div class="comments"><span class=hljs-template-variable>{{ render_disqus_comments() }}</span>&lt;/div></code><br><code><span class=hljs-template-tag>{% <span class=hljs-name><span class=hljs-name>endblock</span></span> %}</span></code></pre> <p>só precisei botar mesmo a div de comentários. daí foi recarregar a página e voilá, tudo funcionando <strong>lindamente</strong>. </p> <hr> <p>enfim, espero ter abordado um pouco melhor alguns detalhes e features interessantes do Lektor. caso tenham alguma pergunta ou dúvida, só mandarem ver nos comentários. é isso por enquanto, minha gente, vejo vocês na próxima! o/ </article></main></section> <nav class=svelte-12rvnlo><ul class=svelte-12rvnlo><li class=svelte-12rvnlo><a href=/ class=svelte-12rvnlo rel=prefetch>about</a></li> <li class=svelte-12rvnlo><a href=blog class=svelte-12rvnlo rel=prefetch aria-current=page>blog</a></li> <li class=svelte-12rvnlo><a href=previous-talks class=svelte-12rvnlo rel=prefetch>talks</a></ul> </nav></section></div> 